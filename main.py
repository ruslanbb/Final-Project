import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
from settings import TOKEN


bot = telebot.TeleBot(TOKEN)


questions = [
    {
        "question": "–í–æ–ø—Ä–æ—Å 1: –Ø ‚Äî –∂–µ–ª–µ–∑–Ω—ã–π —á–µ–ª–æ–≤–µ–∫.",
        "options": ["–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫: –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –¥–æ–º–æ–π", "–ú—Å—Ç–∏—Ç–µ–ª–∏: –§–∏–Ω–∞–ª", "–¢—ë–º–Ω—ã–π —Ä—ã—Ü–∞—Ä—å", "–î–æ–∫—Ç–æ—Ä –°—Ç—Ä—ç–Ω–¥–∂"],  
        "correct": 1
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 2: –Ø ‚Äî —Ç–≤–æ–π –æ—Ç–µ—Ü.",
        "options": ["–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä 2: –°—É–¥–Ω—ã–π –¥–µ–Ω—å", "–ó–≤—ë–∑–¥–Ω—ã–µ –≤–æ–π–Ω—ã: –ò–º–ø–µ—Ä–∏—è –Ω–∞–Ω–æ—Å–∏—Ç –æ—Ç–≤–µ—Ç–Ω—ã–π —É–¥–∞—Ä", "–•–æ–±–±–∏—Ç: –ù–µ–∂–¥–∞–Ω–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ", "–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä –∏ –ö—É–±–æ–∫ –æ–≥–Ω—è"],
        "correct": 1
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 3: –ü–æ—á–µ–º—É –±—ã –∏ –Ω–µ—Ç? –ü–æ—á–µ–º—É –±—ã –∏ –¥–∞?",
        "options": ["–í–ª–∞—Å—Ç–µ–ª–∏–Ω –∫–æ–ª–µ—Ü: –î–≤–µ –∫—Ä–µ–ø–æ—Å—Ç–∏", "–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä –∏ –ü—Ä–∏–Ω—Ü-–ø–æ–ª—É–∫—Ä–æ–≤–∫–∞", "–î–æ—Å—Ç–∞—Ç—å –Ω–æ–∂–∏", "–î–∂–æ–∫–µ—Ä"],
        "correct": 1
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 4: –î–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏ –∏ –¥–∞–ª—å—à–µ!",
        "options": ["–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä—É—à–µ–∫", "–ö–æ—Ä–æ–ª—å –õ–µ–≤", "–ì–∞–¥–∫–∏–π –Ø", "–¢–∞–π–Ω–∞—è –∂–∏–∑–Ω—å –¥–æ–º–∞—à–Ω–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö"],
        "correct": 0
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 5: –°–∏–ª–∞ –ø—Ä–µ–±—É–¥–µ—Ç —Å —Ç–æ–±–æ–π, –≤—Å–µ–≥–¥–∞.",
        "options": ["–°—Ç—Ä–∞–∂–∏ –ì–∞–ª–∞–∫—Ç–∏–∫–∏", "–ú–∞—Ç—Ä–∏—Ü–∞", "–ó–≤—ë–∑–¥–Ω—ã–µ –≤–æ–π–Ω—ã: –ù–æ–≤–∞—è –Ω–∞–¥–µ–∂–¥–∞", "–ë–µ–≥—É—â–∏–π –ø–æ –ª–µ–∑–≤–∏—é"],
        "correct": 2
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 6: –û–Ω–∏ –º–æ–≥—É—Ç –æ—Ç–Ω—è—Ç—å —É –Ω–∞—Å –∂–∏–∑–Ω—å, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–Ω–∏–º—É—Ç –Ω–∞—à—É —Å–≤–æ–±–æ–¥—É!",
        "options": ["–ì–ª–∞–¥–∏–∞—Ç–æ—Ä", "–•—Ä–∞–±—Ä–æ–µ —Å–µ—Ä–¥—Ü–µ", "–¢—Ä–æ—è", "300 —Å–ø–∞—Ä—Ç–∞–Ω—Ü–µ–≤"],
        "correct": 1
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 7: –¢—ã –Ω–µ –ø—Ä–æ–π–¥—ë—à—å!",
        "options": ["–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä –∏ –î–∞—Ä—ã —Å–º–µ—Ä—Ç–∏", "–í–ª–∞—Å—Ç–µ–ª–∏–Ω –∫–æ–ª–µ—Ü: –ë—Ä–∞—Ç—Å—Ç–≤–æ –∫–æ–ª—å—Ü–∞", "–ß–µ–ª–æ–≤–µ–∫ –∏–∑ —Å—Ç–∞–ª–∏", "–ü–µ—Ä—Å–∏ –î–∂–µ–∫—Å–æ–Ω –∏ –ø–æ—Ö–∏—Ç–∏—Ç–µ–ª—å –º–æ–ª–Ω–∏–π"],
        "correct": 1
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 8: –õ–µ–≥–µ–Ω... –ø–æ–¥–æ–∂–¥–∏... –¥–∞—Ä–Ω–æ! –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ!",
        "options": ["–û—á–µ–Ω—å —Å—Ç—Ä–∞—à–Ω–æ–µ –∫–∏–Ω–æ", "–¢–µ–æ—Ä–∏—è –±–æ–ª—å—à–æ–≥–æ –≤–∑—Ä—ã–≤–∞", "–ö–∞–∫ —è –≤—Å—Ç—Ä–µ—Ç–∏–ª –≤–∞—à—É –º–∞–º—É", "–î—ç–¥–ø—É–ª"],
        "correct": 2
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 9: –° –≤–µ–ª–∏–∫–æ–π —Å–∏–ª–æ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤–µ–ª–∏–∫–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.",
        "options": ["–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫ (2002)", "–ñ–µ–ª–µ–∑–Ω—ã–π —á–µ–ª–æ–≤–µ–∫", "–ú—Å—Ç–∏—Ç–µ–ª–∏", "–õ—é–¥–∏ –ò–∫—Å"],
        "correct": 0
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å 10 –Ø –≥—É–ª—è—é —Ç—É—Ç!",
        "options": ["–û–¥–∏–Ω –¥–æ–º–∞ 2", "–§–æ—Ä—Ä–µ—Å—Ç –ì–∞–º–ø", "–û—Ö–æ—Ç–Ω–∏–∫–∏ –∑–∞ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è–º–∏", "–í–æ–ª–∫ —Å –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç"],
        "correct": 0
    }
]


user_data = {}

@bot.message_handler(commands=["start"])
def start_quiz(message):
    
    user_data[message.chat.id] = {"current_question": 0, "score": 0}

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–≤–∏–∑-–±–æ—Ç–∞. –Ø –∑–∞–¥–∞–º —Ç–µ–±–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏–∑ —Ñ–∏–ª—å–º–æ–≤, –∏ —Ç—ã –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç. –ü–æ–º–Ω–∏ –∑–∞ –∫–∞–∂–¥—ã–π –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç –æ—Ç–Ω–∏–º–∞—Ç—å—Å—è 1 –±–∞–ª–ª. –£–¥–∞—á–∏! üéâ")

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
    send_question(message.chat.id)

def send_question(chat_id):
    """ –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é """
    
    user = user_data.get(chat_id)  # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user is None:
        return
    
    question_index = user["current_question"]  # –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

    if question_index < len(questions):  # –ï—Å–ª–∏ –µ—â—ë –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã
        question = questions[question_index]  # –ë–µ—Ä—ë–º —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
        markup = InlineKeyboardMarkup()  # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

        # –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–∞
        for i, option in enumerate(question["options"]):
            markup.add(InlineKeyboardButton(text=option, callback_data=f"answer_{i}"))

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å —Å –∫–Ω–æ–ø–∫–∞–º–∏
        bot.send_message(chat_id, question["question"], reply_markup=markup)
    else:
        # –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥
        bot.send_message(chat_id, f"–ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω! –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {user['score']} –∏–∑ {len(questions)}")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Å –æ—Ç–≤–µ—Ç–∞–º–∏
@bot.callback_query_handler(func=lambda call: call.data.startswith("answer_"))
def process_answer(call):
    """ –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è """

    chat_id = call.message.chat.id  # –ü–æ–ª—É—á–∞–µ–º ID —á–∞—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    user = user_data.get(chat_id)  # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    if user is None:
        return

    question_index = user["current_question"]  # –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
    question = questions[question_index]  # –¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
    selected_answer = int(call.data.split("_")[1])  # –£–∑–Ω–∞—ë–º, –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
    if selected_answer == question["correct"]:
        user["score"] += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç
        bot.answer_callback_query(call.id, "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ")  # –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    else:
        bot.answer_callback_query(call.id, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå")  # –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –Ω–µ–≤–µ—Ä–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
        # –í—ã—á–∏—Ç–∞–µ–º –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

    user["current_question"] += 1  # –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
    send_question(chat_id)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.polling(none_stop=True)